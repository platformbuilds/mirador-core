{{- if .Values.secrets.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ default (printf "%s-mirador-env" (include "mirador-core.fullname" .)) .Values.secrets.name }}
  labels:
    {{- include "mirador-core.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- with .Values.secrets.data.JWT_SECRET }}
  {{- if . }}
  JWT_SECRET: {{ . | quote }}
  {{- end }}
  {{- end }}
  {{- with .Values.secrets.data.LDAP_PASSWORD }}
  {{- if . }}
  LDAP_PASSWORD: {{ . | quote }}
  {{- end }}
  {{- end }}
  {{- with .Values.secrets.data.SMTP_PASSWORD }}
  {{- if . }}
  SMTP_PASSWORD: {{ . | quote }}
  {{- end }}
  {{- end }}
  {{- with .Values.secrets.data.REDIS_PASSWORD }}
  {{- if . }}
  REDIS_PASSWORD: {{ . | quote }}
  {{- end }}
  {{- end }}
  {{- with .Values.secrets.data.VM_PASSWORD }}
  {{- if . }}
  VM_PASSWORD: {{ . | quote }}
  {{- end }}
  {{- end }}
  {{- with .Values.secrets.data.ADMIN_PASSWORD }}
  {{- if . }}
  ADMIN_PASSWORD: {{ . | quote }}
  {{- end }}
  {{- end }}
  {{- /* RBAC Bootstrap Configuration */}}
  {{- if .Values.mirador.auth.rbac.bootstrap.enabled }}
  RBAC_BOOTSTRAP_ENABLED: "true"
  RBAC_ADMIN_USER_ID: {{ .Values.mirador.auth.rbac.bootstrap.admin_user.user_id | quote }}
  RBAC_ADMIN_USERNAME: {{ .Values.mirador.auth.rbac.bootstrap.admin_user.username | quote }}
  RBAC_ADMIN_EMAIL: {{ .Values.mirador.auth.rbac.bootstrap.admin_user.email | quote }}
  {{- if not .Values.secrets.data.ADMIN_PASSWORD }}
  RBAC_ADMIN_PASSWORD: {{ .Values.mirador.auth.rbac.bootstrap.admin_user.password | quote }}
  {{- end }}
  RBAC_ADMIN_GLOBAL_ROLE: {{ .Values.mirador.auth.rbac.bootstrap.admin_user.global_role | quote }}
  RBAC_DEFAULT_TENANT_ID: {{ .Values.mirador.auth.rbac.bootstrap.default_tenant.tenant_id | quote }}
  RBAC_DEFAULT_TENANT_NAME: {{ .Values.mirador.auth.rbac.bootstrap.default_tenant.name | quote }}
  RBAC_DEFAULT_TENANT_DESCRIPTION: {{ .Values.mirador.auth.rbac.bootstrap.default_tenant.description | quote }}
  {{- end }}
{{- end }}

