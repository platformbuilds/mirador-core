{
  "otel_fintrans_trace_based_kpis": [
    {
      "kpi_name": "Transaction Latency P95",
      "kpi_formula": "histogram_quantile(0.95, sum(rate(transaction_latency_seconds_bucket[5m])) by (le))",
      "kpi_definition": "95th percentile transaction latency across all services. Indicates the latency threshold that 95% of transactions are below.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "impact",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "fintrans"
    },
    {
      "kpi_name": "Transaction Latency P99",
      "kpi_formula": "histogram_quantile(0.99, sum(rate(transaction_latency_seconds_bucket[5m])) by (le))",
      "kpi_definition": "99th percentile transaction latency. Captures tail latency indicating potential user experience degradation.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "impact",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "fintrans"
    },
    {
      "kpi_name": "Transaction Latency Average",
      "kpi_formula": "sum(rate(transaction_latency_seconds_sum[5m])) / sum(rate(transaction_latency_seconds_count[5m]))",
      "kpi_definition": "Average transaction latency across all transactions. Baseline for normal operation.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "impact",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "fintrans"
    },
    {
      "kpi_name": "Failed Transactions Percentage",
      "kpi_formula": "sum(rate(transaction_latency_seconds_bucket{failed=\"true\"}[5m])) by () / sum(rate(transaction_latency_seconds_bucket[5m])) by () * 100",
      "kpi_definition": "Percentage of failed transactions detected via the 'failed' label in metrics. Primary impact KPI.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "impact",
      "classifier": "error",
      "sentiment": "negative",
      "serviceFamily": "fintrans"
    },
    {
      "kpi_name": "Database Latency P95",
      "kpi_formula": "histogram_quantile(0.95, sum(rate(db_latency_seconds_bucket[5m])) by (le, service_name))",
      "kpi_definition": "95th percentile database operation latency by service. Identifies services with slow database access.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "database"
    },
    {
      "kpi_name": "Database Latency P99",
      "kpi_formula": "histogram_quantile(0.99, sum(rate(db_latency_seconds_bucket[5m])) by (le, service_name))",
      "kpi_definition": "99th percentile database latency. Captures tail latency in database operations.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "database"
    },
    {
      "kpi_name": "Database Latency Average",
      "kpi_formula": "sum(rate(db_latency_seconds_sum[5m])) by (service_name) / sum(rate(db_latency_seconds_count[5m])) by (service_name)",
      "kpi_definition": "Average database operation latency per service. Shows baseline database performance.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "database"
    },
    {
      "kpi_name": "Database Failed Operations",
      "kpi_formula": "sum(rate(db_latency_seconds_bucket{failed=\"true\"}[5m])) by (service_name) / sum(rate(db_latency_seconds_bucket[5m])) by (service_name) * 100",
      "kpi_definition": "Percentage of failed database operations per service (detected via failed label).",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "error",
      "sentiment": "negative",
      "serviceFamily": "database"
    },
    {
      "kpi_name": "Kafka Consume Latency P95",
      "kpi_formula": "histogram_quantile(0.95, sum(rate(kafka_consume_latency_seconds_bucket[5m])) by (le))",
      "kpi_definition": "95th percentile Kafka consume operation latency. Indicates message processing time.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "kafka"
    },
    {
      "kpi_name": "Kafka Consume Latency P99",
      "kpi_formula": "histogram_quantile(0.99, sum(rate(kafka_consume_latency_seconds_bucket[5m])) by (le))",
      "kpi_definition": "99th percentile Kafka consume latency. Captures tail latency for message processing.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "kafka"
    },
    {
      "kpi_name": "Kafka Produce Latency P95",
      "kpi_formula": "histogram_quantile(0.95, sum(rate(kafka_produce_latency_seconds_bucket[5m])) by (le))",
      "kpi_definition": "95th percentile Kafka produce latency. Indicates message publishing time.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "kafka"
    },
    {
      "kpi_name": "Kafka Produce Latency P99",
      "kpi_formula": "histogram_quantile(0.99, sum(rate(kafka_produce_latency_seconds_bucket[5m])) by (le))",
      "kpi_definition": "99th percentile Kafka produce latency. Captures tail latency for message publishing.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "kafka"
    },
    {
      "kpi_name": "Span Call Rate",
      "kpi_formula": "sum(rate(traces_span_metrics_calls_total[5m])) by (service_name, span_name)",
      "kpi_definition": "Call rate for each span/operation by service. Shows throughput per operation.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "tracing"
    },
    {
      "kpi_name": "Span Error Rate",
      "kpi_formula": "sum(rate(traces_span_metrics_calls_total{failed=\"true\"}[5m])) by (service_name, span_name) / sum(rate(traces_span_metrics_calls_total[5m])) by (service_name, span_name) * 100",
      "kpi_definition": "Error rate per span/operation. Identifies problematic operations causing failures.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "error",
      "sentiment": "negative",
      "serviceFamily": "tracing"
    },
    {
      "kpi_name": "Span Duration P95",
      "kpi_formula": "histogram_quantile(0.95, sum(rate(traces_span_metrics_duration_milliseconds_bucket[5m])) by (le, service_name, span_name))",
      "kpi_definition": "95th percentile span duration by service and operation. Identifies slow operations.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "tracing"
    },
    {
      "kpi_name": "Span Duration P99",
      "kpi_formula": "histogram_quantile(0.99, sum(rate(traces_span_metrics_duration_milliseconds_bucket[5m])) by (le, service_name, span_name))",
      "kpi_definition": "99th percentile span duration. Captures tail latency in operations.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "tracing"
    },
    {
      "kpi_name": "Span Average Duration",
      "kpi_formula": "sum(rate(traces_span_metrics_duration_milliseconds_sum[5m])) by (service_name, span_name) / sum(rate(traces_span_metrics_duration_milliseconds_count[5m])) by (service_name, span_name)",
      "kpi_definition": "Average span duration by service and operation. Baseline for normal span execution time.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "tracing"
    },
    {
      "kpi_name": "Service Graph Client Latency P95",
      "kpi_formula": "histogram_quantile(0.95, sum(rate(traces_service_graph_request_client_seconds_bucket[5m])) by (le))",
      "kpi_definition": "95th percentile latency for client-side requests in service graph. Shows outbound call latency.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "tracing"
    },
    {
      "kpi_name": "Service Graph Server Latency P95",
      "kpi_formula": "histogram_quantile(0.95, sum(rate(traces_service_graph_request_server_seconds_bucket[5m])) by (le))",
      "kpi_definition": "95th percentile latency for server-side request handling. Shows inbound request processing time.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "performance",
      "sentiment": "neutral",
      "serviceFamily": "tracing"
    },
    {
      "kpi_name": "Anomaly Score Current Level",
      "kpi_formula": "avg(iforest_anomaly_score) by (service_name)",
      "kpi_definition": "Current Isolation Forest anomaly score by service. Higher values indicate more anomalous behavior.",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "anomaly",
      "sentiment": "negative",
      "serviceFamily": "anomaly_detection"
    },
    {
      "kpi_name": "Critical Anomaly Detection Rate",
      "kpi_formula": "sum(increase(iforest_is_anomaly[5m])) by (service_name)",
      "kpi_definition": "Rate of critical anomalies detected per service (iforest_is_anomaly > threshold).",
      "signal_type": "metrics",
      "query_type": "PromQL",
      "datastore": "victoriametrics",
      "layer": "cause",
      "classifier": "anomaly",
      "sentiment": "negative",
      "serviceFamily": "anomaly_detection"
    }
  ]
}
