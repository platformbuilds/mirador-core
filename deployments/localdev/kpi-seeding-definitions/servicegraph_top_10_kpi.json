{
  "service_graph_technical_kpis": [
    {
      "name": "Service Dependency Error Rate",
      "formula": "sum(rate(servicegraph_client_failed_requests_total[5m])) by (client, server) / sum(rate(servicegraph_client_requests_total[5m])) by (client, server) * 100",
      "definition": "The percentage of failed requests between client and server services. High error rates indicate communication issues, timeout problems, or downstream service failures between microservices.",
      "layer": "cause",
      "classifier": "service_communication",
      "sentiment": "negative",
      "signalType": "metrics",
      "queryType": "PromQL",
      "datastore": "victoriametrics",
      "serviceFamily": "servicegraph"
    },
    {
      "name": "Inter-Service Latency (95th Percentile)",
      "formula": "histogram_quantile(0.95, sum(rate(servicegraph_client_duration_seconds_bucket[5m])) by (le, client, server))",
      "definition": "The latency for the slowest 5% of requests between client and server services. High latency indicates network bottlenecks, slow downstream services, or resource contention in the service mesh.",
      "layer": "cause",
      "classifier": "network_performance",
      "sentiment": "negative",
      "signalType": "metrics",
      "queryType": "PromQL",
      "datastore": "victoriametrics",
      "serviceFamily": "servicegraph"
    },
    {
      "name": "Weighted Anomaly Score by Service Dependency",
      "formula": "avg by (client, server) (iforest_anomaly_score * rate(servicegraph_client_requests_total[5m]))",
      "definition": "The average anomaly score weighted by request volume between services. Higher scores indicate service dependencies with more significant and frequent anomalous behavior patterns.",
      "layer": "cause",
      "classifier": "anomaly_severity",
      "sentiment": "negative",
      "signalType": "metrics",
      "queryType": "PromQL",
      "datastore": "victoriametrics",
      "serviceFamily": "servicegraph"
    },
    {
      "name": "Service Dependency Saturation",
      "formula": "count(rate(servicegraph_client_requests_total[5m])) by (server)",
      "definition": "The number of unique client services calling each server service. High saturation indicates single points of failure or services that are critical dependencies for multiple upstream services.",
      "layer": "cause",
      "classifier": "dependency_concentration",
      "sentiment": "negative",
      "signalType": "metrics",
      "queryType": "PromQL",
      "datastore": "victoriametrics",
      "serviceFamily": "servicegraph"
    },
    {
      "name": "High Anomaly Score Request Rate",
      "formula": "sum(rate(servicegraph_client_requests_total[5m])) by (client, server) * iforest_anomaly_score > 0.8",
      "definition": "The rate of requests with anomaly scores above 0.8 between services. Identifies service dependencies experiencing high-confidence anomalous behavior patterns.",
      "layer": "cause",
      "classifier": "critical_anomaly",
      "sentiment": "negative",
      "signalType": "metrics",
      "queryType": "PromQL",
      "datastore": "victoriametrics",
      "serviceFamily": "servicegraph"
    },
    {
      "name": "Service Error Ratio",
      "formula": "sum(rate(servicegraph_server_failed_requests_total[5m])) by (server) / sum(rate(servicegraph_server_requests_total[5m])) by (server) * 100",
      "definition": "The percentage of failed requests handled by each server service. High error ratios indicate service instability, buggy code, or resource exhaustion in specific services.",
      "layer": "cause",
      "classifier": "service_reliability",
      "sentiment": "negative",
      "signalType": "metrics",
      "queryType": "PromQL",
      "datastore": "victoriametrics",
      "serviceFamily": "servicegraph"
    },
    {
      "name": "Connection Type Distribution",
      "formula": "sum(rate(servicegraph_client_requests_total[5m])) by (connection_type)",
      "definition": "The distribution of requests by connection type (messaging, database, http, etc.). Helps identify communication patterns and potential bottlenecks in specific connection types.",
      "layer": "cause",
      "classifier": "connection_analysis",
      "sentiment": "neutral",
      "signalType": "metrics",
      "queryType": "PromQL",
      "datastore": "victoriametrics",
      "serviceFamily": "servicegraph"
    },
    {
      "name": "Service Fan-Out Rate",
      "formula": "count(rate(servicegraph_client_requests_total[5m])) by (client)",
      "definition": "The number of downstream server services called by each client service. High fan-out indicates orchestration services that may become bottlenecks or single points of failure.",
      "layer": "cause",
      "classifier": "service_coupling",
      "sentiment": "negative",
      "signalType": "metrics",
      "queryType": "PromQL",
      "datastore": "victoriametrics",
      "serviceFamily": "servicegraph"
    },
    {
      "name": "Anomaly Score Trend by Connection Type",
      "formula": "delta(avg(iforest_anomaly_score * rate(servicegraph_client_requests_total[5m])) by (connection_type)[1h:])",
      "definition": "The change in average anomaly score by connection type over the last hour. Positive trends indicate deteriorating stability in specific communication protocols.",
      "layer": "cause",
      "classifier": "anomaly_trend",
      "sentiment": "negative",
      "signalType": "metrics",
      "queryType": "PromQL",
      "datastore": "victoriametrics",
      "serviceFamily": "servicegraph"
    },
    {
      "name": "Failed Connection Rate by Type",
      "formula": "sum(rate(servicegraph_client_failed_requests_total[5m])) by (connection_type) / sum(rate(servicegraph_client_requests_total[5m])) by (connection_type) * 100",
      "definition": "The percentage of failed requests by connection type. Helps identify if specific communication protocols (HTTP, gRPC, messaging, database) are experiencing higher failure rates.",
      "layer": "cause",
      "classifier": "protocol_reliability",
      "sentiment": "negative",
      "signalType": "metrics",
      "queryType": "PromQL",
      "datastore": "victoriametrics",
      "serviceFamily": "servicegraph"
    }
  ]
}
