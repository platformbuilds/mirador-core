# Production Environment Configuration
environment: production
port: 8010
log_level: warn

database:
  victoria_metrics:
    endpoints:
      - "http://vm-select-0.vm-select.mirador.svc.cluster.local:8481"
      - "http://vm-select-1.vm-select.mirador.svc.cluster.local:8481"
      - "http://vm-select-2.vm-select.mirador.svc.cluster.local:8481"
    timeout: 30000
  victoria_logs:
    endpoints:
      - "http://vl-select-0.vl-select.mirador.svc.cluster.local:9428"
      - "http://vl-select-1.vl-select.mirador.svc.cluster.local:9428"
    timeout: 30000
  victoria_traces:
    endpoints:
      - "http://vt-select-0.vt-select.mirador.svc.cluster.local:10428"
      - "http://vt-select-1.vt-select.mirador.svc.cluster.local:10428"
    timeout: 30000

grpc:
  predict_engine:
    endpoint: "predict-engine.mirador.svc.cluster.local:9091"
    models: 
      - "isolation_forest"
      - "lstm_trend"
      - "anomaly_detector"
      - "ensemble_predictor"
      - "seasonal_decomposition"
    timeout: 30000
  rca_engine:
    endpoint: "rca-engine.mirador.svc.cluster.local:9092"
    correlation_threshold: 0.9 # Higher confidence in production
    timeout: 30000
  alert_engine:
    endpoint: "alert-engine.mirador.svc.cluster.local:9093"
    rules_path: "/etc/mirador/alert-rules.yaml"
    timeout: 30000

auth:
  ldap:
    url: "ldap://ldap.company.com"
    base_dn: "dc=company,dc=com"
    username: "cn=mirador,ou=services,dc=company,dc=com"
    enabled: true
  oauth:
    client_id: "mirador-core-prod"
    redirect_url: "https://mirador.company.com/auth/callback"
    issuer: "https://auth.company.com"
    enabled: true
  rbac:
    enabled: true
    admin_role: "mirador-admin"
  jwt:
    expiry_minutes: 480 # 8 hours

cache:
  nodes:
    - "redis-cluster-0.redis-cluster.mirador.svc.cluster.local:6379"
    - "redis-cluster-1.redis-cluster.mirador.svc.cluster.local:6379"
    - "redis-cluster-2.redis-cluster.mirador.svc.cluster.local:6379"
    - "redis-cluster-3.redis-cluster.mirador.svc.cluster.local:6379"
    - "redis-cluster-4.redis-cluster.mirador.svc.cluster.local:6379"
    - "redis-cluster-5.redis-cluster.mirador.svc.cluster.local:6379"
  ttl: 600 # 10 minutes in production
  db: 0

cors:
  allowed_origins:
    - "https://mirador.company.com"
    - "https://mirador-ui.company.com"
  allowed_methods:
    - "GET"
    - "POST"
    - "PUT"
    - "DELETE"
    - "OPTIONS"
  allowed_headers:
    - "Content-Type"
    - "Authorization"
    - "X-Tenant-ID"
    - "X-User-ID"
    - "X-Request-ID"
  exposed_headers:
    - "X-Cache"
    - "X-Rate-Limit-Remaining"
    - "X-Rate-Limit-Reset"
    - "X-Execution-Time"
  allow_credentials: true
  max_age: 86400 # 24 hours

integrations:
  slack:
    channel: "#mirador-alerts"
    enabled: true
  ms_teams:
    enabled: true
  email:
    smtp_host: "smtp.company.com"
    smtp_port: 587
    username: "mirador@company.com"
    from_address: "MIRADOR Platform <mirador@company.com>"
    enabled: true

websocket:
  enabled: true
  max_connections: 5000
  read_buffer_size: 4096
  write_buffer_size: 4096
  ping_interval: 30
  max_message_size: 2097152 # 2MB

monitoring:
  enabled: true
  metrics_path: "/metrics"
  prometheus_enabled: true
  tracing_enabled: true
jaeger_endpoint: "http://jaeger-collector.observability.svc.cluster.local:14268/api/traces"

# Search Engine Configuration
search:
  default_engine: "lucene"
  enable_bleve: true
  enable_lucene: true
  query_cache:
    enabled: true
    ttl: 1800
  bleve:
    logs_enabled: true
    traces_enabled: true
    metrics_enabled: false
    index_path: "/var/lib/mirador/bleve"
    batch_size: 1000
    max_memory_mb: 512
    memory_optimization:
      object_pooling: true
      adaptive_cache: true
    storage:
      memory_cache_ratio: 0.3
      disk_cache_ratio: 0.7
      max_concurrent_queries: 50
    metrics_sync:
      enabled: true
      strategy: "hybrid"  # Use hybrid strategy in production
      interval: 15m
      full_sync_interval: 24h
      batch_size: 2000  # Larger batches for production
      max_retries: 5    # More retries in production
      retry_delay: 30s
      time_range_lookback: 2h  # Longer lookback for production
      shard_count: 6  # More shards for production

# Unified Query Engine Configuration (Phase 1.5)
unified_query:
  enabled: true
  cache_ttl: 10m
  max_cache_ttl: 2h
  default_limit: 2000
  enable_correlation: true

uploads:
  # Bulk CSV upload limit (bytes); default 5 MiB.
  bulk_max_bytes: 5242880
