# MIRADOR-CORE Configuration File
# Complete configuration with all available options

environment: development
port: 8010
log_level: info

# VictoriaMetrics Ecosystem Configuration
database:
  victoria_metrics:
    endpoints:
      - "http://vm-select-0.vm-select:8428"
      - "http://vm-select-1.vm-select:8428"
    timeout: 30000
    username: ""
    password: "" # Set via environment variable
    # Optional: enable DNS-based discovery of vmselect pods behind a headless Service
    # discovery:
    #   enabled: true
    #   service: "vm-select.vm-select.svc.cluster.local"
    #   port: 8481
    #   scheme: "http"
    #   refresh_seconds: 30
    #   use_srv: false
    
  victoria_logs:
    endpoints:
      - "http://vl-select-0.vl-select:9428"
      - "http://vl-select-1.vl-select:9428"
    timeout: 30000
    username: ""
    password: ""
    # discovery:
    #   enabled: true
    #   service: "vl-select.vl-select.svc.cluster.local"
    #   port: 9428
    #   scheme: "http"
    #   refresh_seconds: 30
    #   use_srv: false
    
  victoria_traces:
    endpoints:
      - "http://vt-select-0.vt-select:10428"
      - "http://vt-select-1.vt-select:10428"
    timeout: 30000
    username: ""
    password: ""
    # discovery:
    #   enabled: true
    #   service: "vt-select.vt-select.svc.cluster.local"
    #   port: 10428
    #   scheme: "http"
    #   refresh_seconds: 30
    #   use_srv: false

# AI Engines gRPC Configuration
grpc:
  predict_engine:
    endpoint: "predict-engine.mirador:9091"
    models:
      - "isolation_forest"
      - "lstm_trend" 
      - "anomaly_detector"
      - "ensemble_predictor"
    timeout: 30000
    
  rca_engine:
    endpoint: "rca-engine.mirador:9092"
    correlation_threshold: 0.85
    timeout: 30000
    
  alert_engine:
    endpoint: "alert-engine.mirador:9093"
    rules_path: "/etc/mirador/alert-rules.yaml"
    timeout: 30000

# Authentication and Authorization (handled externally - this section is deprecated)
# Mirador-core is designed to run behind an external API gateway or service mesh
# that handles authentication and RBAC.
auth: {}

# Valkey Cluster Caching
cache:
  nodes:
    - "localhost:6379"
  ttl: 300 # 5 minutes default
  password: "" # Set via environment variable
  db: 0

# Cross-Origin Resource Sharing
cors:
  allowed_origins:
    - "https://mirador.company.com"
    - "https://mirador-ui.company.com"
  allowed_methods:
    - "GET"
    - "POST"
    - "PUT"
    - "DELETE"
    - "OPTIONS"
  allowed_headers:
    - "Content-Type"
    - "Authorization"
  exposed_headers:
    - "X-Cache"
    - "X-Rate-Limit-Remaining"
    - "X-Rate-Limit-Reset"
  allow_credentials: true
  max_age: 3600

# External Integrations
integrations:
  slack:
    webhook_url: "" # Set via environment variable
    channel: "#mirador-alerts"
    enabled: false
    
  ms_teams:
    webhook_url: "" # Set via environment variable
    enabled: false
    
  email:
    smtp_host: "smtp.company.com"
    smtp_port: 587
    username: "mirador@company.com"
    password: "" # Set via environment variable
    from_address: "mirador@company.com"
    enabled: false

# Real-time WebSocket Streaming
websocket:
  enabled: true
  max_connections: 1000
  read_buffer_size: 1024
  write_buffer_size: 1024
  ping_interval: 30 # seconds
  max_message_size: 1048576 # 1MB

# Self-monitoring Configuration
monitoring:
  enabled: true
  metrics_path: "/metrics"
  prometheus_enabled: true
  tracing_enabled: false

# Schema Store Configuration (Weaviate)
weaviate:
  enabled: true
  scheme: "http"
  host: "localhost"
  port: 8080
  api_key: "" # Set via environment variable
  consistency: "quorum"
  use_official: true
  nested_keys:
    - "tags"
    - "examples"
    - "allowed_values"

# Search Engine Configuration
search:
  default_engine: "lucene"
  enable_bleve: true
  enable_lucene: true

# Unified Query Engine Configuration (Phase 1.5)
unified_query:
  enabled: true
  cache_ttl: 5m
  max_cache_ttl: 1h
  default_limit: 1000
  enable_correlation: true

uploads:
  # Bulk CSV upload limit (bytes); default 5 MiB.
  bulk_max_bytes: 5242880
  jaeger_endpoint: "http://jaeger:14268/api/traces"

# API Key Management Configuration
api_keys:
  enabled: true
  # Default limits applied system-wide unless overridden
  default_limits:
    max_keys_per_user: 10
    max_keys_per_tenant_admin: 25
    max_keys_per_global_admin: 100
  # Tenant-specific limit overrides (empty by default)
  tenant_limits: []
  # Global system-wide overrides (null = use default_limits)
  global_limits_override: null
  # Permission settings
  allow_tenant_override: true   # Allow tenant admins to override limits
  allow_admin_override: true    # Allow global admins to override limits
  # Expiry settings
  max_expiry_days: 365         # Maximum days for API key expiry (0 = unlimited)
  min_expiry_days: 1           # Minimum days for API key expiry
  enforce_expiry: false        # Require expiry date on all new keys
