{
  "openapi": "3.0.3",
  "info": {
    "title": "MIRADOR-CORE API (code-first)",
    "description": "This OpenAPI document is generated from the code-first route registrations\nin internal/api/server.go. It lists only endpoints actually registered by\nthe server bootstrap (health, metrics, docs, swagger, /api/v1/* groups\nfor RCA, KPI definitions, Unified and UQL).\n",
    "version": "8.0.0"
  },
  "servers": [
    {
      "url": "{scheme}://{host}:{port}",
      "description": "Configurable server",
      "variables": {
        "scheme": {
          "description": "URL scheme",
          "default": "http",
          "enum": [
            "http",
            "https"
          ]
        },
        "host": {
          "description": "Hostname or IP address",
          "default": "127.0.0.1"
        },
        "port": {
          "description": "Server port",
          "default": "8010"
        }
      }
    }
  ],
  "paths": {
    "/": {
      "get": {
        "summary": "Root redirect to Swagger UI",
        "responses": {
          "302": {
            "description": "Redirect"
          }
        }
      }
    },
    "/swagger/index.html": {
      "get": {
        "summary": "Swagger UI entry",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/openapi.yaml": {
      "get": {
        "summary": "OpenAPI YAML",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/openapi.json": {
      "get": {
        "summary": "OpenAPI JSON",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/metrics": {
      "get": {
        "summary": "Prometheus metrics",
        "responses": {
          "200": {
            "description": "Prometheus metrics text"
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "Public health check",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/ready": {
      "get": {
        "summary": "Readiness check",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/microservices/status": {
      "get": {
        "summary": "Microservices status",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/metrics": {
      "get": {
        "summary": "Prometheus metrics (v1 group)",
        "responses": {
          "200": {
            "description": "Prometheus metrics text"
          }
        }
      }
    },
    "/api/v1/health": {
      "get": {
        "summary": "API-v1 health",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/ready": {
      "get": {
        "summary": "API-v1 readiness",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/microservices/status": {
      "get": {
        "summary": "API-v1 microservices status",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/unified/service-graph": {
      "post": {
        "summary": "Build / retrieve service-graph for RCA",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/kpi/defs": {
      "get": {
        "summary": "List KPI definitions",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "post": {
        "summary": "Create or update KPI definition",
        "requestBody": {
          "description": "KPI definition to create or update. Wrap the KPI object in { \"kpiDefinition\": { ... } }.",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "kpiDefinition": {
                    "type": "object"
                  }
                }
              },
              "example": {
                "kpiDefinition": {
                  "name": "api_errors_total",
                  "kind": "tech",
                  "namespace": "apigw_springboot_top_10_kpi",
                  "unit": "count",
                  "format": "integer",
                  "layer": "impact",
                  "signalType": "metrics",
                  "classifier": "errors",
                  "definition": "Total number of API errors observed at the gateway per minute.",
                  "sentiment": "negative",
                  "businessImpact": "If errors increase, end users may experience failed requests and revenue impact.",
                  "tags": [
                    "apigw",
                    "errors",
                    "pagerduty"
                  ],
                  "examples": [
                    {
                      "service.name": "api-gateway",
                      "region": "us-east-1",
                      "value": 42
                    }
                  ],
                  "aggregationWindowHint": "1m",
                  "dimensionsHint": [
                    "service.name",
                    "region"
                  ]
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          },
          "201": {
            "description": "Created (new KPI)",
            "content": {
              "application/json": {
                "example": {
                  "status": "created",
                  "id": "api_errors_total--apigw_springboot_top_10_kpi"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/kpi/defs/bulk-json": {
      "post": {
        "summary": "Bulk ingest KPI definitions (JSON)",
        "requestBody": {
          "description": "Bulk JSON payload containing an array of KPI definition objects.",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "items": {
                    "type": "array",
                    "items": {
                      "type": "object"
                    }
                  }
                }
              },
              "example": {
                "items": [
                  {
                    "name": "api_errors_total",
                    "layer": "impact",
                    "signalType": "metrics",
                    "sentiment": "negative",
                    "definition": "Total number of API errors observed at the gateway per minute.",
                    "tags": [
                      "apigw",
                      "errors"
                    ]
                  },
                  {
                    "name": "api_request_latency_p95",
                    "layer": "cause",
                    "signalType": "metrics",
                    "sentiment": "negative",
                    "classifier": "latency",
                    "componentType": "springboot"
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "example": {
                  "total": 2,
                  "successCount": 2,
                  "failureCount": 0,
                  "failures": []
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/kpi/defs/bulk-csv": {
      "post": {
        "summary": "Bulk ingest KPI definitions (CSV)",
        "requestBody": {
          "description": "Multipart form with `file` field containing CSV. First row must be headers such as id,name,namespace,kind,layer,signalType,sentiment,definition,tags,examples",
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "example": {
                  "total": 3,
                  "successCount": 2,
                  "failureCount": 1,
                  "failures": [
                    {
                      "row": 3,
                      "message": "invalid examples JSON"
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/kpi/defs/{id}": {
      "get": {
        "summary": "Get KPI definition by id",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "KPI definition retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                },
                "example": {
                  "id": "api_errors_total--apigw_springboot_top_10_kpi",
                  "name": "api_errors_total",
                  "namespace": "apigw_springboot_top_10_kpi",
                  "kind": "tech",
                  "layer": "impact",
                  "signalType": "metrics",
                  "definition": "Total number of API errors observed at the gateway per minute.",
                  "tags": [
                    "apigw",
                    "errors"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "KPI not found",
            "content": {
              "application/json": {
                "example": {
                  "error": "kpi not found"
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete KPI definition by id",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeleteResult"
                },
                "examples": {
                  "success": {
                    "summary": "All stores reported deleted",
                    "value": {
                      "result": {
                        "weaviate": {
                          "found": true,
                          "deleted": true
                        },
                        "valkey": {
                          "found": true,
                          "deleted": true
                        },
                        "bleve": {
                          "found": true,
                          "deleted": true
                        }
                      }
                    }
                  },
                  "partialFailure": {
                    "summary": "Weaviate deleted, Valkey delete failed, Bleve OK",
                    "value": {
                      "result": {
                        "weaviate": {
                          "found": true,
                          "deleted": true
                        },
                        "valkey": {
                          "found": true,
                          "deleted": false,
                          "error": "valkey: connection timeout"
                        },
                        "bleve": {
                          "found": true,
                          "deleted": true
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/mira/rca_analyze": {
      "post": {
        "summary": "Generate AI-powered explanation for RCA results",
        "description": "Translates technical RCA (Root Cause Analysis) output into non-technical narratives.\nSupports multiple AI providers: OpenAI (GPT-4), Anthropic (Claude), vLLM, and Ollama.\nIncludes smart caching with Valkey for cost optimization and rate limiting.\n\n**Workflow:**\n1. Call `POST /api/v1/unified/rca` with time window to get RCA analysis\n2. Extract the `data` field from the RCA response\n3. Pass it as `rcaData` to this endpoint\n4. Receive human-readable explanation\n\n**Example:**\n```bash\n# Step 1: Get RCA analysis\nRCA_RESPONSE=$(curl -X POST http://localhost:8010/api/v1/unified/rca \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"startTime\":\"2025-12-03T07:30:00Z\",\"endTime\":\"2025-12-03T08:30:00Z\"}')\n\n# Step 2: Extract data field and send to MIRA\necho \"$RCA_RESPONSE\" | jq '{rcaData: .data}' | \\\n  curl -X POST http://localhost:8010/api/v1/mira/rca_analyze \\\n  -H \"Content-Type: application/json\" \\\n  -d @-\n```\n",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "rcaData"
                ],
                "properties": {
                  "rcaData": {
                    "type": "object",
                    "description": "The complete RCA response data object from /api/v1/unified/rca endpoint.\nThis should be the 'data' field from the RCA response (RCAIncidentDTO).\n",
                    "properties": {
                      "impact": {
                        "type": "object",
                        "description": "Impact/incident context",
                        "properties": {
                          "id": {
                            "type": "string",
                            "example": "corr_1764756501"
                          },
                          "impactService": {
                            "type": "string",
                            "example": "DB Operations"
                          },
                          "metricName": {
                            "type": "string",
                            "example": "sum(db_ops_total)"
                          },
                          "timeStart": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "timeEnd": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "impactSummary": {
                            "type": "string"
                          },
                          "severity": {
                            "type": "number",
                            "format": "float"
                          }
                        }
                      },
                      "rootCause": {
                        "type": "object",
                        "description": "Selected root cause step",
                        "properties": {
                          "whyIndex": {
                            "type": "integer"
                          },
                          "service": {
                            "type": "string"
                          },
                          "component": {
                            "type": "string"
                          },
                          "ring": {
                            "type": "string"
                          },
                          "summary": {
                            "type": "string"
                          },
                          "score": {
                            "type": "number"
                          }
                        }
                      },
                      "chains": {
                        "type": "array",
                        "description": "All candidate RCA chains",
                        "items": {
                          "type": "object",
                          "properties": {
                            "steps": {
                              "type": "array",
                              "items": {
                                "type": "object"
                              }
                            },
                            "score": {
                              "type": "number"
                            },
                            "rank": {
                              "type": "integer"
                            }
                          }
                        }
                      },
                      "generatedAt": {
                        "type": "string",
                        "format": "date-time"
                      },
                      "score": {
                        "type": "number",
                        "format": "float"
                      },
                      "diagnostics": {
                        "type": "object"
                      },
                      "timeRings": {
                        "type": "object"
                      }
                    }
                  }
                }
              },
              "examples": {
                "fullRCAResponse": {
                  "summary": "Complete RCA data (from /api/v1/unified/rca response.data)",
                  "value": {
                    "rcaData": {
                      "impact": {
                        "id": "corr_1764756501",
                        "impactService": "DB Operations",
                        "metricName": "sum(db_ops_total)",
                        "timeStart": "2025-12-03T07:30:00Z",
                        "timeEnd": "2025-12-03T08:30:00Z",
                        "impactSummary": "Impact detected on DB Operations",
                        "severity": 0.9
                      },
                      "rootCause": {
                        "whyIndex": 5,
                        "service": "process",
                        "component": "deployment",
                        "ring": "R2_SHORT",
                        "summary": "Why 5: process (deployment) showed anomalies",
                        "score": 0.27
                      },
                      "chains": [
                        {
                          "steps": [
                            {
                              "whyIndex": 1,
                              "service": "DB Operations",
                              "component": "sum(db_ops_total)",
                              "ring": "R1_IMMEDIATE",
                              "score": 0.9
                            }
                          ],
                          "score": 0.63,
                          "rank": 1
                        }
                      ],
                      "generatedAt": "2025-12-03T10:08:21Z",
                      "score": 0.63
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully generated AI explanation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "success"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "explanation": {
                          "type": "string",
                          "description": "Non-technical narrative explanation"
                        },
                        "provider": {
                          "type": "string",
                          "description": "AI provider used (openai, anthropic, ollama, vllm)"
                        },
                        "model": {
                          "type": "string",
                          "description": "Model name (e.g., gpt-4, claude-3.5-sonnet)"
                        },
                        "tokensUsed": {
                          "type": "integer",
                          "description": "Number of tokens consumed"
                        },
                        "cached": {
                          "type": "boolean",
                          "description": "Whether response was served from cache"
                        }
                      }
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Successful AI explanation",
                    "value": {
                      "status": "success",
                      "data": {
                        "explanation": "Your application experienced a spike in failed transactions at 2:30 PM. This was caused by database connection errors, which started 2 minutes earlier when the connection pool became exhausted due to increased traffic.",
                        "provider": "openai",
                        "model": "gpt-4",
                        "tokensUsed": 245,
                        "cached": false
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (missing rcaData or malformed JSON)"
          },
          "429": {
            "description": "Rate limit exceeded"
          },
          "500": {
            "description": "AI service error or internal server error"
          }
        }
      }
    },
    "/api/v1/mira/rca_analyze_async": {
      "post": {
        "summary": "Submit async MIRA RCA analysis task",
        "description": "Submits RCA data for asynchronous AI-powered explanation generation. Returns immediately with a task ID.\nClient can poll the task status endpoint to check progress and retrieve results.\n\n**Advantages over sync API:**\n- No HTTP timeout for large RCA analysis (sync API has 5 minute limit)\n- Real-time progress tracking (chunk-by-chunk processing visibility)\n- Optional webhook callbacks for event-driven architectures\n- Task state persisted in Valkey (survives server restarts)\n\n**Workflow:**\n1. Submit RCA data → Receive taskId immediately (202 Accepted)\n2. Poll `GET /api/v1/mira/rca_analyze/{taskId}` every 5-10 seconds\n3. When status = \"completed\", retrieve result from response\n4. (Optional) Provide callbackUrl for webhook notification\n\n**Example:**\n```bash\n# Step 1: Submit async task\nTASK_RESPONSE=$(curl -X POST http://localhost:8010/api/v1/mira/rca_analyze_async \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"rcaData\": {...},\n    \"callbackUrl\": \"https://webhook.example.com/mira-callback\"\n  }')\n\n# Step 2: Extract taskId\nTASK_ID=$(echo \"$TASK_RESPONSE\" | jq -r '.taskId')\n\n# Step 3: Poll for status\nwhile true; do\n  STATUS=$(curl http://localhost:8010/api/v1/mira/rca_analyze/$TASK_ID | jq -r '.status')\n  if [ \"$STATUS\" = \"completed\" ] || [ \"$STATUS\" = \"failed\" ]; then\n    break\n  fi\n  echo \"Progress: $(curl http://localhost:8010/api/v1/mira/rca_analyze/$TASK_ID | jq '.progress')\"\n  sleep 5\ndone\n```\n",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "rcaData"
                ],
                "properties": {
                  "rcaData": {
                    "type": "object",
                    "description": "Complete RCA response data (same as sync API)"
                  },
                  "callbackUrl": {
                    "type": "string",
                    "format": "uri",
                    "description": "Optional webhook URL for completion notification (POST with task status)"
                  }
                }
              },
              "examples": {
                "withCallback": {
                  "summary": "Async task with webhook callback",
                  "value": {
                    "rcaData": {
                      "impact": {
                        "id": "corr_1764756501",
                        "impactService": "DB Operations",
                        "metricName": "sum(db_ops_total)",
                        "severity": 0.9
                      },
                      "rootCause": {
                        "whyIndex": 5,
                        "service": "process",
                        "component": "deployment",
                        "score": 0.27
                      },
                      "chains": [
                        {
                          "steps": [
                            "..."
                          ],
                          "score": 0.63
                        }
                      ]
                    },
                    "callbackUrl": "https://webhook.example.com/mira-callback"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Task accepted for processing",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "accepted"
                    },
                    "taskId": {
                      "type": "string",
                      "format": "uuid",
                      "description": "UUID v4 task identifier",
                      "example": "550e8400-e29b-41d4-a716-446655440000"
                    },
                    "statusUrl": {
                      "type": "string",
                      "description": "URL to poll for task status",
                      "example": "/api/v1/mira/rca_analyze/550e8400-e29b-41d4-a716-446655440000"
                    },
                    "message": {
                      "type": "string",
                      "example": "Task submitted for processing. Poll statusUrl for results."
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (missing rcaData or malformed JSON)"
          },
          "500": {
            "description": "Task creation failed"
          }
        }
      }
    },
    "/api/v1/mira/rca_analyze/{taskId}": {
      "get": {
        "summary": "Get MIRA task status and result",
        "description": "Retrieves the current status and result of an async MIRA analysis task.\nTask data is stored in Valkey with 24-hour TTL.\n\n**Task Status Flow:**\n- `pending` → Task queued, not yet started\n- `processing` → Background processing in progress (check `progress` field for details)\n- `completed` → Task finished successfully (result available in `result` field)\n- `failed` → Task failed (error message in `error` field)\n\n**Progress Tracking:**\nWhen status = \"processing\", the `progress` object shows:\n- `totalChunks` - Total number of chunks to process\n- `completedChunks` - Chunks finished so far\n- `currentChunk` - Current chunk being processed\n- `currentStage` - Current processing stage (e.g., \"chunk_2_processing\")\n- `lastUpdated` - Timestamp of last progress update\n\n**Stages:**\n- `toon_conversion` - Converting RCA to TOON format\n- `prompt_rendering` - Building AI prompts\n- `chunk_processing_started` - Beginning chunked generation\n- `chunk_N_processing` - Processing chunk N\n- `chunk_N_completed` - Chunk N finished\n- `stitching_final_explanation` - Combining chunk results\n",
        "parameters": [
          {
            "name": "taskId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Task ID returned from POST /api/v1/mira/rca_analyze_async",
            "example": "550e8400-e29b-41d4-a716-446655440000"
          }
        ],
        "responses": {
          "200": {
            "description": "Task status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "taskId": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "status": {
                      "type": "string",
                      "enum": [
                        "pending",
                        "processing",
                        "completed",
                        "failed"
                      ]
                    },
                    "progress": {
                      "type": "object",
                      "description": "Progress tracking (present when status = processing or completed)",
                      "properties": {
                        "totalChunks": {
                          "type": "integer"
                        },
                        "completedChunks": {
                          "type": "integer"
                        },
                        "currentChunk": {
                          "type": "integer"
                        },
                        "currentStage": {
                          "type": "string"
                        },
                        "lastUpdated": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    },
                    "submittedAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "startedAt": {
                      "type": "string",
                      "format": "date-time",
                      "description": "When processing started (null if pending)"
                    },
                    "completedAt": {
                      "type": "string",
                      "format": "date-time",
                      "description": "When task finished (null if not completed/failed)"
                    },
                    "result": {
                      "type": "object",
                      "description": "Analysis result (present when status = completed)",
                      "properties": {
                        "status": {
                          "type": "string"
                        },
                        "data": {
                          "type": "object",
                          "properties": {
                            "explanation": {
                              "type": "string"
                            },
                            "provider": {
                              "type": "string"
                            },
                            "model": {
                              "type": "string"
                            },
                            "tokensUsed": {
                              "type": "integer"
                            },
                            "cached": {
                              "type": "boolean"
                            },
                            "totalChunks": {
                              "type": "integer"
                            },
                            "generationTimeMs": {
                              "type": "integer"
                            }
                          }
                        }
                      }
                    },
                    "error": {
                      "type": "string",
                      "description": "Error message (present when status = failed)"
                    },
                    "callbackUrl": {
                      "type": "string",
                      "description": "Webhook URL (if provided during submission)"
                    }
                  }
                },
                "examples": {
                  "pending": {
                    "summary": "Task pending (not yet started)",
                    "value": {
                      "taskId": "550e8400-e29b-41d4-a716-446655440000",
                      "status": "pending",
                      "submittedAt": "2025-12-03T14:30:00Z"
                    }
                  },
                  "processing": {
                    "summary": "Task processing (chunk 2 of 3)",
                    "value": {
                      "taskId": "550e8400-e29b-41d4-a716-446655440000",
                      "status": "processing",
                      "progress": {
                        "totalChunks": 3,
                        "completedChunks": 1,
                        "currentChunk": 2,
                        "currentStage": "chunk_2_processing",
                        "lastUpdated": "2025-12-03T14:32:15Z"
                      },
                      "submittedAt": "2025-12-03T14:30:00Z",
                      "startedAt": "2025-12-03T14:30:01Z"
                    }
                  },
                  "completed": {
                    "summary": "Task completed successfully",
                    "value": {
                      "taskId": "550e8400-e29b-41d4-a716-446655440000",
                      "status": "completed",
                      "progress": {
                        "totalChunks": 3,
                        "completedChunks": 3,
                        "currentChunk": 3,
                        "currentStage": "completed",
                        "lastUpdated": "2025-12-03T14:35:42Z"
                      },
                      "result": {
                        "status": "success",
                        "data": {
                          "explanation": "First, users experienced failed transactions (Why #1, IMPACT layer)...",
                          "provider": "openai",
                          "model": "gpt-4",
                          "tokensUsed": 3891,
                          "cached": false,
                          "totalChunks": 3,
                          "generationTimeMs": 341000
                        }
                      },
                      "submittedAt": "2025-12-03T14:30:00Z",
                      "startedAt": "2025-12-03T14:30:01Z",
                      "completedAt": "2025-12-03T14:35:42Z"
                    }
                  },
                  "failed": {
                    "summary": "Task failed",
                    "value": {
                      "taskId": "550e8400-e29b-41d4-a716-446655440000",
                      "status": "failed",
                      "error": "AI provider timeout after 3 retries",
                      "submittedAt": "2025-12-03T14:30:00Z",
                      "startedAt": "2025-12-03T14:30:01Z",
                      "completedAt": "2025-12-03T14:32:18Z"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Task not found (invalid taskId or expired after 24h TTL)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "error"
                    },
                    "error": {
                      "type": "string",
                      "example": "task_not_found"
                    },
                    "taskId": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/unified/query": {
      "post": {
        "summary": "Unified query",
        "requestBody": {
          "description": "Unified query accepts either a wrapped object { \"query\": { ... } }\n(UnifiedQueryRequest) or a direct UnifiedQuery object. Use snake_case\nfor UnifiedQuery timestamps (`start_time` / `end_time`).\n",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              },
              "examples": {
                "wrapped": {
                  "summary": "Wrapped UnifiedQueryRequest (preferred)",
                  "value": {
                    "query": {
                      "id": "q-123",
                      "type": "metrics",
                      "query": "metrics:http_requests > 1000",
                      "start_time": "2025-11-29T12:00:00Z",
                      "end_time": "2025-11-29T12:05:00Z",
                      "timeout": "30s",
                      "parameters": {
                        "limit": 100,
                        "groupBy": [
                          "service.name"
                        ]
                      },
                      "correlation_options": {
                        "enabled": true,
                        "correlation_keys": [
                          "trace_id"
                        ],
                        "time_window": "5m",
                        "engines": [
                          "metrics",
                          "logs"
                        ]
                      },
                      "cache_options": {
                        "enabled": true,
                        "ttl": "5m",
                        "bypass_cache": false
                      }
                    }
                  }
                },
                "direct": {
                  "summary": "Direct UnifiedQuery (legacy / shorthand)",
                  "value": {
                    "id": "q-123",
                    "type": "metrics",
                    "query": "metrics:http_requests > 1000",
                    "start_time": "2025-11-29T12:00:00Z",
                    "end_time": "2025-11-29T12:05:00Z"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/unified/correlation": {
      "post": {
        "summary": "Unified correlation",
        "requestBody": {
          "description": "Correlation endpoint supports two shapes:\n - Preferred canonical TimeWindowRequest: { \"startTime\", \"endTime\" } (camelCase)\n",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              },
              "examples": {
                "timeWindow": {
                  "summary": "Canonical time-window request (Stage-01 contract)",
                  "value": {
                    "startTime": "2025-11-29T12:00:00Z",
                    "endTime": "2025-11-29T12:15:00Z"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/unified/failures/detect": {
      "post": {
        "summary": "Detect component failures in a time range",
        "description": "Detects component failures using error signals (spans with error tag = true) and \nanomaly metrics (iforest_is_anomaly = true) within a specified time window. \nReturns summarized results with service+component breakdowns, failure IDs, UUIDs, \nand metrics summaries. Automatically persists failures to Weaviate storage.\n",
        "requestBody": {
          "description": "FailureDetectionRequest with required time_range and optional components/services.\nValidates that end > start, returns HTTP 400 if invalid.\n",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "time_range"
                ],
                "properties": {
                  "time_range": {
                    "type": "object",
                    "required": [
                      "start",
                      "end"
                    ],
                    "properties": {
                      "start": {
                        "type": "string",
                        "format": "date-time",
                        "description": "Start of detection window (RFC3339 UTC)"
                      },
                      "end": {
                        "type": "string",
                        "format": "date-time",
                        "description": "End of detection window (RFC3339 UTC, must be > start)"
                      }
                    }
                  },
                  "components": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Optional list of component names to filter detection",
                    "example": [
                      "api-gateway",
                      "kafka",
                      "cassandra"
                    ]
                  },
                  "services": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Optional list of service names to target for detection",
                    "example": [
                      "fintrans-simulator",
                      "payment-service"
                    ]
                  }
                }
              },
              "examples": {
                "basic": {
                  "summary": "Detect all failures in time range",
                  "value": {
                    "time_range": {
                      "start": "2025-12-01T05:30:00Z",
                      "end": "2025-12-02T05:30:00Z"
                    }
                  }
                },
                "filtered": {
                  "summary": "Detect failures for specific components",
                  "value": {
                    "time_range": {
                      "start": "2025-12-01T10:00:00Z",
                      "end": "2025-12-01T11:00:00Z"
                    },
                    "components": [
                      "api-gateway",
                      "kafka"
                    ],
                    "services": [
                      "fintrans-simulator"
                    ]
                  }
                },
                "invalid": {
                  "summary": "Invalid time window (end <= start)",
                  "value": {
                    "time_range": {
                      "start": "2025-12-01T12:00:00Z",
                      "end": "2025-12-01T11:00:00Z"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Failure detection successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "incidents": {
                      "type": "array",
                      "description": "List of detected failure incidents (empty if none found)",
                      "items": {
                        "type": "object",
                        "properties": {
                          "incident_id": {
                            "type": "string",
                            "example": "incident_kafka_1733022000"
                          },
                          "failure_id": {
                            "type": "string",
                            "description": "Human-readable identifier (service-component-YYYYMMDD-HHMMSS)",
                            "example": "kafka-producer-kafka-20251201-103000"
                          },
                          "failure_uuid": {
                            "type": "string",
                            "format": "uuid",
                            "description": "Deterministic UUID v5 for deduplication",
                            "example": "e458d90f-f525-58a9-9e92-9f91faa73cf2"
                          },
                          "time_range": {
                            "type": "object",
                            "properties": {
                              "start": {
                                "type": "string",
                                "format": "date-time"
                              },
                              "end": {
                                "type": "string",
                                "format": "date-time"
                              }
                            }
                          },
                          "primary_component": {
                            "type": "string"
                          },
                          "affected_transaction_ids": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "services_involved": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          },
                          "failure_mode": {
                            "type": "string"
                          },
                          "confidence": {
                            "type": "number",
                            "format": "float"
                          },
                          "severity": {
                            "type": "string",
                            "enum": [
                              "low",
                              "medium",
                              "high",
                              "critical"
                            ]
                          }
                        }
                      }
                    },
                    "summary": {
                      "type": "object",
                      "properties": {
                        "total_incidents": {
                          "type": "integer"
                        },
                        "time_range": {
                          "type": "object",
                          "properties": {
                            "start": {
                              "type": "string",
                              "format": "date-time"
                            },
                            "end": {
                              "type": "string",
                              "format": "date-time"
                            }
                          }
                        },
                        "service_component_summaries": {
                          "type": "array",
                          "description": "Summary for each service+component combination",
                          "items": {
                            "type": "object",
                            "properties": {
                              "service": {
                                "type": "string"
                              },
                              "component": {
                                "type": "string"
                              },
                              "failure_id": {
                                "type": "string",
                                "description": "Human-readable identifier"
                              },
                              "failure_uuid": {
                                "type": "string",
                                "format": "uuid",
                                "description": "Unique identifier for Weaviate storage"
                              },
                              "failure_count": {
                                "type": "integer"
                              },
                              "affected_transactions": {
                                "type": "integer"
                              },
                              "average_anomaly_score": {
                                "type": "number",
                                "format": "float"
                              },
                              "average_confidence": {
                                "type": "number",
                                "format": "float"
                              },
                              "error_spans_count": {
                                "type": "integer"
                              },
                              "error_metrics_count": {
                                "type": "integer"
                              },
                              "last_failure_timestamp": {
                                "type": "string",
                                "format": "date-time"
                              }
                            }
                          }
                        },
                        "metrics_error_summary": {
                          "type": "object",
                          "description": "Aggregated error and anomaly metrics",
                          "properties": {
                            "total_error_metrics": {
                              "type": "integer",
                              "description": "Count of metrics with status_code=STATUS_CODE_ERROR"
                            },
                            "total_anomaly_metrics": {
                              "type": "integer",
                              "description": "Count of metrics with iforest_is_anomaly=true"
                            },
                            "error_metrics_by_name": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "metric_name": {
                                    "type": "string"
                                  },
                                  "count": {
                                    "type": "integer"
                                  },
                                  "labels": {
                                    "type": "object",
                                    "additionalProperties": {
                                      "type": "string"
                                    }
                                  },
                                  "average_value": {
                                    "type": "number",
                                    "format": "float"
                                  },
                                  "last_value": {
                                    "type": "number",
                                    "format": "float"
                                  },
                                  "last_timestamp": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                }
                              }
                            },
                            "anomaly_metrics_by_name": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "metric_name": {
                                    "type": "string"
                                  },
                                  "count": {
                                    "type": "integer"
                                  },
                                  "labels": {
                                    "type": "object",
                                    "additionalProperties": {
                                      "type": "string"
                                    }
                                  },
                                  "average_value": {
                                    "type": "number",
                                    "format": "float"
                                  },
                                  "last_value": {
                                    "type": "number",
                                    "format": "float"
                                  },
                                  "last_timestamp": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "enum": [
                        "Invalid request format",
                        "Invalid time window: end time must be after start time"
                      ]
                    }
                  }
                },
                "examples": {
                  "invalidFormat": {
                    "value": {
                      "error": "Invalid request format",
                      "details": "EOF"
                    }
                  },
                  "invalidTimeWindow": {
                    "value": {
                      "error": "Invalid time window: end time must be after start time"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "details": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/unified/failures/correlate": {
      "post": {
        "summary": "Correlate transaction failures",
        "description": "Correlates failures for specific transaction IDs within a time window.\nReturns failures affecting the specified transactions with correlation details.\n",
        "requestBody": {
          "description": "TransactionFailureCorrelationRequest with transaction IDs and time range",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "transaction_ids",
                  "time_range"
                ],
                "properties": {
                  "transaction_ids": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "List of transaction IDs to correlate",
                    "example": [
                      "tx-001",
                      "tx-002",
                      "tx-003"
                    ]
                  },
                  "time_range": {
                    "type": "object",
                    "required": [
                      "start",
                      "end"
                    ],
                    "properties": {
                      "start": {
                        "type": "string",
                        "format": "date-time",
                        "description": "Start of correlation window (RFC3339 UTC)"
                      },
                      "end": {
                        "type": "string",
                        "format": "date-time",
                        "description": "End of correlation window (RFC3339 UTC)"
                      }
                    }
                  }
                }
              },
              "examples": {
                "transactions": {
                  "summary": "Correlate specific transactions",
                  "value": {
                    "transaction_ids": [
                      "txn-123",
                      "txn-456",
                      "txn-789"
                    ],
                    "time_range": {
                      "start": "2025-12-01T10:00:00Z",
                      "end": "2025-12-01T11:00:00Z"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Transaction correlation successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "incidents": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    },
                    "summary": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid request format or time window"
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      }
    },
    "/api/v1/unified/failures/list": {
      "post": {
        "summary": "List all failure records from Weaviate storage",
        "description": "Returns a paginated list of all stored failure records with minimal information:\nfailure_id, summary (services, components, detector version, confidence, counts),\nand timestamps. Full details can be retrieved via /failures/get endpoint.\n",
        "requestBody": {
          "description": "Pagination parameters (all optional)",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "limit": {
                    "type": "integer",
                    "description": "Number of records per page (default 100, max 1000)",
                    "default": 100,
                    "minimum": 1,
                    "maximum": 1000
                  },
                  "offset": {
                    "type": "integer",
                    "description": "Pagination offset (default 0)",
                    "default": 0,
                    "minimum": 0
                  }
                }
              },
              "examples": {
                "list_all": {
                  "summary": "List all failures with defaults",
                  "value": {
                    "limit": 100,
                    "offset": 0
                  }
                },
                "list_with_pagination": {
                  "summary": "List with custom pagination",
                  "value": {
                    "limit": 50,
                    "offset": 100
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Failure list retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "failures": {
                      "type": "array",
                      "description": "List of failure records with minimal info",
                      "items": {
                        "type": "object",
                        "properties": {
                          "failure_id": {
                            "type": "string",
                            "description": "Human-readable identifier",
                            "example": "fintrans-simulator-api-gatewaycall-tps-20251201-101045"
                          },
                          "summary": {
                            "type": "object",
                            "properties": {
                              "services": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "example": [
                                  "fintrans-simulator"
                                ]
                              },
                              "components": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                },
                                "example": [
                                  "api-gateway.call_tps"
                                ]
                              },
                              "detector": {
                                "type": "string",
                                "example": "1.0.0"
                              },
                              "confidence": {
                                "type": "number",
                                "format": "float"
                              },
                              "error_count": {
                                "type": "integer",
                                "description": "Number of error signals"
                              },
                              "anomaly_count": {
                                "type": "integer",
                                "description": "Number of anomaly signals"
                              }
                            }
                          },
                          "timestamps": {
                            "type": "object",
                            "properties": {
                              "detection": {
                                "type": "string",
                                "format": "date-time",
                                "description": "When failure was detected"
                              },
                              "start": {
                                "type": "string",
                                "format": "date-time",
                                "description": "Time window start"
                              },
                              "end": {
                                "type": "string",
                                "format": "date-time",
                                "description": "Time window end"
                              },
                              "created_at": {
                                "type": "string",
                                "format": "date-time",
                                "description": "Record creation timestamp"
                              },
                              "updated_at": {
                                "type": "string",
                                "format": "date-time",
                                "description": "Last update timestamp"
                              }
                            }
                          }
                        }
                      }
                    },
                    "count": {
                      "type": "integer",
                      "description": "Number of records in this page"
                    },
                    "total": {
                      "type": "integer",
                      "description": "Total number of failure records in storage"
                    },
                    "limit": {
                      "type": "integer",
                      "description": "Page size used"
                    },
                    "offset": {
                      "type": "integer",
                      "description": "Offset used"
                    }
                  }
                },
                "example": {
                  "failures": [
                    {
                      "failure_id": "fintrans-simulator-api-gatewaycall-tps-20251201-101045",
                      "summary": {
                        "services": [
                          "fintrans-simulator"
                        ],
                        "components": [
                          "api-gateway.call_tps"
                        ],
                        "detector": "1.0.0",
                        "confidence": 0.85,
                        "error_count": 2,
                        "anomaly_count": 0
                      },
                      "timestamps": {
                        "detection": "2025-12-01T10:20:28Z",
                        "start": "2025-12-01T10:00:00Z",
                        "end": "2025-12-01T10:30:00Z",
                        "created_at": "2025-12-01T10:20:28Z",
                        "updated_at": "2025-12-01T10:20:28Z"
                      }
                    }
                  ],
                  "count": 1,
                  "total": 1,
                  "limit": 100,
                  "offset": 0
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error - Failure store not available or query failed"
          }
        }
      }
    },
    "/api/v1/unified/failures/get": {
      "post": {
        "summary": "Get full failure record details including verbose output",
        "description": "Retrieves a complete failure record by failure_id, including all raw error signals,\nraw anomaly signals, and complete metadata. Returns verbose, unprocessed data \nsuitable for detailed investigation and RCA.\n",
        "requestBody": {
          "description": "Request parameters for retrieving failure details",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "failure_id"
                ],
                "properties": {
                  "failure_id": {
                    "type": "string",
                    "description": "Human-readable failure ID (format service-component-YYYYMMDD-HHMMSS)",
                    "example": "fintrans-simulator-api-gatewaycall-tps-20251201-101045"
                  }
                }
              },
              "examples": {
                "retrieve_failure": {
                  "summary": "Retrieve failure by ID",
                  "value": {
                    "failure_id": "fintrans-simulator-api-gatewaycall-tps-20251201-101045"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Full failure record retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "failure": {
                      "type": "object",
                      "properties": {
                        "failure_uuid": {
                          "type": "string",
                          "format": "uuid",
                          "description": "Unique identifier (UUID v5)"
                        },
                        "failure_id": {
                          "type": "string",
                          "description": "Human-readable identifier"
                        },
                        "time_range": {
                          "type": "object",
                          "properties": {
                            "start": {
                              "type": "string",
                              "format": "date-time"
                            },
                            "end": {
                              "type": "string",
                              "format": "date-time"
                            }
                          }
                        },
                        "services": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "components": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "raw_error_signals": {
                          "type": "array",
                          "description": "All raw error signals (spans with error tag and error metrics)",
                          "items": {
                            "type": "object",
                            "properties": {
                              "signal_type": {
                                "type": "string",
                                "enum": [
                                  "span",
                                  "metric"
                                ]
                              },
                              "metric_name": {
                                "type": "string",
                                "description": "Only present for metric signals"
                              },
                              "service": {
                                "type": "string"
                              },
                              "component": {
                                "type": "string"
                              },
                              "data": {
                                "type": "object",
                                "additionalProperties": true,
                                "description": "Raw signal data (trace info, metric values, labels)"
                              },
                              "timestamp": {
                                "type": "string",
                                "format": "date-time"
                              }
                            }
                          }
                        },
                        "raw_anomaly_signals": {
                          "type": "array",
                          "description": "All raw anomaly signals (metrics with iforest_is_anomaly=true)",
                          "items": {
                            "type": "object",
                            "properties": {
                              "signal_type": {
                                "type": "string",
                                "enum": [
                                  "span",
                                  "metric"
                                ]
                              },
                              "metric_name": {
                                "type": "string"
                              },
                              "service": {
                                "type": "string"
                              },
                              "component": {
                                "type": "string"
                              },
                              "data": {
                                "type": "object",
                                "additionalProperties": true
                              },
                              "timestamp": {
                                "type": "string",
                                "format": "date-time"
                              }
                            }
                          }
                        },
                        "detection_timestamp": {
                          "type": "string",
                          "format": "date-time",
                          "description": "When the failure was detected"
                        },
                        "detector_version": {
                          "type": "string",
                          "description": "Version of the detection engine"
                        },
                        "confidence_score": {
                          "type": "number",
                          "format": "float",
                          "description": "Confidence in detection (0-1)"
                        },
                        "created_at": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "updated_at": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - failure_id parameter required",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Invalid request format"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Failure record does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Failure not found"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      }
    },
    "/api/v1/unified/failures/delete": {
      "post": {
        "summary": "Delete a failure record from storage",
        "description": "Deletes a failure record from Weaviate storage by its failure_id.\nOnce deleted, the record cannot be retrieved.\n",
        "requestBody": {
          "description": "Request parameters for deleting a failure",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "failure_id"
                ],
                "properties": {
                  "failure_id": {
                    "type": "string",
                    "description": "Human-readable failure ID to delete",
                    "example": "fintrans-simulator-api-gatewaycall-tps-20251201-101045"
                  }
                }
              },
              "examples": {
                "delete_failure": {
                  "summary": "Delete failure by ID",
                  "value": {
                    "failure_id": "fintrans-simulator-api-gatewaycall-tps-20251201-101045"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Failure record deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Failure deleted successfully"
                    },
                    "failure_id": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - failure_id parameter required",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "failure_id query parameter is required"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error"
          }
        }
      }
    },
    "/api/v1/unified/metadata": {
      "get": {
        "summary": "Unified query metadata",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/unified/health": {
      "get": {
        "summary": "Unified engine health",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/unified/search": {
      "post": {
        "summary": "Unified search",
        "requestBody": {
          "description": "Search accepts a UnifiedQuery or wrapped UnifiedQueryRequest (same shapes as /query).",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              },
              "examples": {
                "searchExample": {
                  "summary": "Search for specific error events in logs",
                  "value": {
                    "query": {
                      "id": "search-001",
                      "type": "logs",
                      "query": "logs:exception AND service.name:\"checkout-service\"",
                      "start_time": "2025-11-29T11:50:00Z",
                      "end_time": "2025-11-29T12:05:00Z"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/unified/stats": {
      "get": {
        "summary": "Unified engine stats",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/unified/rca": {
      "post": {
        "summary": "Compute RCA using Unified engine (POST)",
        "requestBody": {
          "description": "RCA endpoint expects the canonical time-window payload: { \"startTime\", \"endTime\" }.\nFor compatibility, legacy RCA shapes are still accepted by handlers but the public contract is time-window-only.\n",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              },
              "examples": {
                "timeWindowRCA": {
                  "summary": "RCA time-window request",
                  "value": {
                    "startTime": "2025-11-29T11:00:00Z",
                    "endTime": "2025-11-29T12:00:00Z"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/uql/query": {
      "post": {
        "summary": "UQL query",
        "requestBody": {
          "description": "Execute a Unified Query Language (UQL) query. The handler expects a wrapped\npayload { \"query\": { ... } } where the inner object follows the\nUnifiedQuery shape (id, type, query, start_time/end_time, parameters, etc.).\n",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              },
              "examples": {
                "logsSelect": {
                  "summary": "Logs SELECT query (wrapped)",
                  "value": {
                    "query": {
                      "id": "uql-logs-001",
                      "type": "logs",
                      "query": "SELECT service, level FROM logs:_time:5m WHERE level='error' GROUP BY service",
                      "start_time": "2025-11-29T11:50:00Z",
                      "end_time": "2025-11-29T12:05:00Z",
                      "timeout": "30s",
                      "parameters": {
                        "limit": 100
                      },
                      "correlation_options": {
                        "enabled": true,
                        "correlation_keys": [
                          "trace_id"
                        ],
                        "time_window": "5m",
                        "engines": [
                          "logs",
                          "metrics"
                        ]
                      },
                      "cache_options": {
                        "enabled": true,
                        "ttl": "5m",
                        "bypass_cache": false
                      }
                    }
                  }
                },
                "metricsAgg": {
                  "summary": "Metrics aggregation UQL",
                  "value": {
                    "query": {
                      "id": "uql-metrics-agg-01",
                      "type": "metrics",
                      "query": "AVG(response_time) FROM metrics:http_requests WHERE status='200' GROUP BY service",
                      "start_time": "2025-11-29T11:00:00Z",
                      "end_time": "2025-11-29T12:00:00Z"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/uql/validate": {
      "post": {
        "summary": "UQL validation",
        "requestBody": {
          "description": "Validate the syntax of a UQL query string. Supply a small object with a\ntop-level `query` string field. The endpoint will return whether the\nquery is syntactically valid without executing it.\n",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              },
              "examples": {
                "basic": {
                  "summary": "Validate a simple UQL SELECT",
                  "value": {
                    "query": "SELECT service, count(*) FROM logs:_time:5m GROUP BY service"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/v1/uql/explain": {
      "post": {
        "summary": "UQL explain",
        "requestBody": {
          "description": "Return a (simplified) execution plan for a UQL query. Supply a wrapped\nrequest { \"query\": { ... } } where the inner query contains the UQL string\nand optional metadata (id, type, time-range) used to produce the plan.\n",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              },
              "examples": {
                "explainLogs": {
                  "summary": "Explain a logs SELECT query",
                  "value": {
                    "query": {
                      "id": "test-uql-1",
                      "type": "logs",
                      "query": "SELECT service, level FROM logs:_time:5m WHERE level='error'"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "TimeRange": {
        "type": "object",
        "required": [
          "start",
          "end"
        ],
        "properties": {
          "start": {
            "type": "string",
            "format": "date-time",
            "description": "Start timestamp (RFC3339 UTC)"
          },
          "end": {
            "type": "string",
            "format": "date-time",
            "description": "End timestamp (RFC3339 UTC, must be > start)"
          }
        }
      },
      "MetricSummaryItem": {
        "type": "object",
        "description": "Aggregated metrics summary for a single metric name",
        "properties": {
          "metric_name": {
            "type": "string"
          },
          "count": {
            "type": "integer",
            "description": "Number of times this metric appeared"
          },
          "labels": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            },
            "description": "Labels associated with this metric"
          },
          "average_value": {
            "type": "number",
            "format": "float",
            "description": "Average value across instances"
          },
          "last_value": {
            "type": "number",
            "format": "float",
            "description": "Most recent value"
          },
          "last_timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp of most recent occurrence"
          }
        }
      },
      "MetricsErrorSummary": {
        "type": "object",
        "description": "Aggregated summary of error and anomaly metrics",
        "properties": {
          "total_error_metrics": {
            "type": "integer",
            "description": "Total count of error metrics (status_code=STATUS_CODE_ERROR)"
          },
          "total_anomaly_metrics": {
            "type": "integer",
            "description": "Total count of anomaly metrics (iforest_is_anomaly=true)"
          },
          "error_metrics_by_name": {
            "type": "array",
            "description": "Breakdown of error metrics by name",
            "items": {
              "$ref": "#/components/schemas/MetricSummaryItem"
            }
          },
          "anomaly_metrics_by_name": {
            "type": "array",
            "description": "Breakdown of anomaly metrics by name",
            "items": {
              "$ref": "#/components/schemas/MetricSummaryItem"
            }
          }
        }
      },
      "ServiceComponentSummary": {
        "type": "object",
        "description": "Failure summary for a specific service+component combination",
        "properties": {
          "service": {
            "type": "string",
            "description": "Service name"
          },
          "component": {
            "type": "string",
            "description": "Component name"
          },
          "failure_id": {
            "type": "string",
            "description": "Human-readable identifier (service-component-YYYYMMDD-HHMMSS)"
          },
          "failure_uuid": {
            "type": "string",
            "format": "uuid",
            "description": "Deterministic UUID v5 for Weaviate storage and deduplication"
          },
          "failure_count": {
            "type": "integer",
            "description": "Number of failures detected"
          },
          "affected_transactions": {
            "type": "integer",
            "description": "Number of affected transactions"
          },
          "average_anomaly_score": {
            "type": "number",
            "format": "float",
            "description": "Average anomaly score (0-1)"
          },
          "average_confidence": {
            "type": "number",
            "format": "float",
            "description": "Average confidence (0-1)"
          },
          "error_spans_count": {
            "type": "integer",
            "description": "Number of error spans (with error tag = true)"
          },
          "error_metrics_count": {
            "type": "integer",
            "description": "Number of error metrics (status_code=STATUS_CODE_ERROR)"
          },
          "last_failure_timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp of the most recent failure"
          }
        }
      },
      "FailureIncident": {
        "type": "object",
        "description": "Individual failure incident record",
        "properties": {
          "incident_id": {
            "type": "string",
            "description": "Legacy incident identifier"
          },
          "failure_id": {
            "type": "string",
            "description": "Human-readable failure identifier"
          },
          "failure_uuid": {
            "type": "string",
            "format": "uuid",
            "description": "Unique UUID v5 for deduplication"
          },
          "time_range": {
            "$ref": "#/components/schemas/TimeRange"
          },
          "primary_component": {
            "type": "string"
          },
          "affected_transaction_ids": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "services_involved": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "failure_mode": {
            "type": "string",
            "description": "Type of failure (e.g., CONNECTION_ERROR, TIMEOUT)"
          },
          "confidence": {
            "type": "number",
            "format": "float",
            "description": "Confidence score (0-1)"
          },
          "severity": {
            "type": "string",
            "enum": [
              "low",
              "medium",
              "high",
              "critical"
            ]
          }
        }
      },
      "FailureDetectionRequest": {
        "type": "object",
        "required": [
          "time_range"
        ],
        "properties": {
          "time_range": {
            "$ref": "#/components/schemas/TimeRange"
          },
          "components": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Optional list of components to filter detection"
          },
          "services": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Optional list of services to target"
          }
        }
      },
      "FailureCorrelationResult": {
        "type": "object",
        "description": "Result of failure detection or correlation",
        "properties": {
          "incidents": {
            "type": "array",
            "description": "List of detected incidents (empty array if none)",
            "items": {
              "$ref": "#/components/schemas/FailureIncident"
            }
          },
          "summary": {
            "type": "object",
            "properties": {
              "total_incidents": {
                "type": "integer"
              },
              "time_range": {
                "$ref": "#/components/schemas/TimeRange"
              },
              "components_affected": {
                "type": "object",
                "additionalProperties": {
                  "type": "integer"
                },
                "description": "Count of failures per component"
              },
              "services_involved": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "failure_modes": {
                "type": "object",
                "additionalProperties": {
                  "type": "integer"
                },
                "description": "Count of failures per failure mode"
              },
              "average_confidence": {
                "type": "number",
                "format": "float"
              },
              "anomaly_detected": {
                "type": "boolean"
              },
              "service_component_summaries": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/ServiceComponentSummary"
                }
              },
              "metrics_error_summary": {
                "$ref": "#/components/schemas/MetricsErrorSummary"
              }
            }
          }
        }
      },
      "FailureSignal": {
        "type": "object",
        "description": "Individual error or anomaly signal in a failure record",
        "properties": {
          "signal_type": {
            "type": "string",
            "enum": [
              "span",
              "metric"
            ],
            "description": "Type of signal (span or metric)"
          },
          "metric_name": {
            "type": "string",
            "description": "Only present for metric signals"
          },
          "service": {
            "type": "string"
          },
          "component": {
            "type": "string"
          },
          "data": {
            "type": "object",
            "additionalProperties": true,
            "description": "Raw signal data (trace info, metric values, labels, etc.)"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "FailureRecord": {
        "type": "object",
        "description": "Complete failure record stored in Weaviate (verbose)",
        "properties": {
          "failure_uuid": {
            "type": "string",
            "format": "uuid",
            "description": "Unique identifier (UUID v5)"
          },
          "failure_id": {
            "type": "string",
            "description": "Human-readable identifier"
          },
          "time_range": {
            "$ref": "#/components/schemas/TimeRange"
          },
          "services": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Affected services"
          },
          "components": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Affected components"
          },
          "raw_error_signals": {
            "type": "array",
            "description": "All raw error signals (unprocessed)",
            "items": {
              "$ref": "#/components/schemas/FailureSignal"
            }
          },
          "raw_anomaly_signals": {
            "type": "array",
            "description": "All raw anomaly signals (unprocessed)",
            "items": {
              "$ref": "#/components/schemas/FailureSignal"
            }
          },
          "detection_timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When the failure was detected"
          },
          "detector_version": {
            "type": "string",
            "description": "Version of detection engine"
          },
          "confidence_score": {
            "type": "number",
            "format": "float",
            "description": "Confidence in detection (0-1)"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "FailureListItem": {
        "type": "object",
        "description": "Minimal failure record in list response",
        "properties": {
          "failure_id": {
            "type": "string"
          },
          "summary": {
            "type": "object",
            "properties": {
              "services": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "components": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "detector": {
                "type": "string"
              },
              "confidence": {
                "type": "number",
                "format": "float"
              },
              "error_count": {
                "type": "integer"
              },
              "anomaly_count": {
                "type": "integer"
              }
            }
          },
          "timestamps": {
            "type": "object",
            "properties": {
              "detection": {
                "type": "string",
                "format": "date-time"
              },
              "start": {
                "type": "string",
                "format": "date-time"
              },
              "end": {
                "type": "string",
                "format": "date-time"
              },
              "created_at": {
                "type": "string",
                "format": "date-time"
              },
              "updated_at": {
                "type": "string",
                "format": "date-time"
              }
            }
          }
        }
      },
      "DeleteStoreResult": {
        "type": "object",
        "properties": {
          "found": {
            "type": "boolean",
            "description": "Whether the object/key was found in this store"
          },
          "deleted": {
            "type": "boolean",
            "description": "Whether the object/key was deleted (true if it was removed or already absent)"
          },
          "error": {
            "type": "string",
            "nullable": true,
            "description": "Optional error message if an operation against this store failed"
          }
        },
        "required": [
          "found",
          "deleted"
        ]
      },
      "DeleteResult": {
        "type": "object",
        "properties": {
          "result": {
            "type": "object",
            "properties": {
              "weaviate": {
                "$ref": "#/components/schemas/DeleteStoreResult"
              },
              "valkey": {
                "$ref": "#/components/schemas/DeleteStoreResult"
              },
              "bleve": {
                "$ref": "#/components/schemas/DeleteStoreResult"
              }
            }
          }
        },
        "required": [
          "result"
        ]
      }
    }
  }
}